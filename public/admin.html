<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Admin - Isaac Barbearia</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: Arial, sans-serif; 
      background: #1a1a1a; 
      color: #e0e0e0;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    h1 { 
      color: #ff8c00; 
      text-align: center; 
      margin-bottom: 30px; 
      text-shadow: 0 0 10px rgba(255, 140, 0, 0.3);
    }
    h2 { 
      color: #ff8c00; 
      margin-bottom: 20px; 
    }
    .tabs { 
      display: flex; 
      gap: 10px; 
      margin-bottom: 30px; 
      border-bottom: 2px solid #333;
      flex-wrap: wrap;
      overflow-x: auto;
      padding-bottom: 10px;
    }
    .tabs::-webkit-scrollbar {
      height: 6px;
    }
    .tabs::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    .tabs::-webkit-scrollbar-thumb {
      background: #ff8c00;
      border-radius: 3px;
    }
    .tabs button {
      padding: 14px 24px; 
      background: #2a2a2a; 
      color: #b0b0b0;
      border: none;
      cursor: pointer; 
      font-size: 16px; 
      border-radius: 8px;
      transition: all 0.3s;
      font-weight: 500;
    }
    .tabs button.active { 
      background: #ff8c00; 
      color: #000; 
    }
    .tabs button:hover { 
      background: #ff8c00; 
      color: #000; 
    }
    .tab-count {
      background: #e74c3c;
      color: white;
      padding: 3px 8px;
      border-radius: 50%;
      font-size: 11px;
      margin-left: 8px;
      font-weight: bold;
      min-width: 22px;
      height: 22px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(231, 76, 60, 0.3);
    }
    .tabs button.active .tab-count {
      background: #c0392b;
    }
    .btn-logout { 
      margin-left: auto; 
      background: #e74c3c !important;
    }
    .btn-logout:hover {
      background: #c0392b !important;
    }
    .tab-content { 
      display: none; 
      animation: fadeIn 0.3s; 
      background: #242424; 
      padding: 20px; 
      border-radius: 8px;
      border: 1px solid #333;
    }
    .tab-content.active { 
      display: block; 
    }
    @keyframes fadeIn { 
      from { opacity: 0; } 
      to { opacity: 1; } 
    }
    form {
      background: #2a2a2a; 
      padding: 20px; 
      border-radius: 8px;
      margin-bottom: 30px; 
      display: flex; 
      flex-direction: column; 
      gap: 10px;
      border: 1px solid #333;
    }
    input, textarea {
      padding: 10px; 
      border: 1px solid #444; 
      border-radius: 4px;
      font-size: 14px; 
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: #e0e0e0;
    }
    input:focus, textarea:focus {
      outline: none;
      border-color: #ff8c00;
      box-shadow: 0 0 5px rgba(255, 140, 0, 0.3);
    }
    textarea { 
      resize: vertical; 
      min-height: 80px; 
    }
    button[type="submit"] {
      padding: 12px 20px; 
      background: #ff8c00; 
      color: #000;
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s;
    }
    button[type="submit"]:hover { 
      background: #ffaa00;
      box-shadow: 0 0 10px rgba(255, 140, 0, 0.5);
    }
    table {
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 20px;
      background: #2a2a2a; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      border: 1px solid #333;
    }
    thead { 
      background: #ff8c00; 
      color: #000;
    }
    th, td { 
      padding: 12px; 
      text-align: left; 
      border-bottom: 1px solid #333;
    }
    tbody tr:hover { 
      background: #333;
    }
    .btn-delete {
      padding: 6px 12px; 
      background: #e74c3c; 
      color: white;
      border: none; 
      border-radius: 4px; 
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-delete:hover { 
      background: #c0392b;
      box-shadow: 0 0 8px rgba(231, 76, 60, 0.5);
    }
    .cards {
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px; 
      margin-top: 20px;
    }
    .card {
      background: #2a2a2a; 
      padding: 15px; 
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      border: 1px solid #444;
      border-left: 4px solid #ff8c00;
      transition: all 0.3s ease;
      position: relative;
      min-height: 250px;
      display: flex;
      flex-direction: column;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.6);
    }
    .card.color-blue {
      border-left-color: #3498db;
    }
    .card.color-blue h3 {
      color: #3498db;
    }
    .card.color-green {
      border-left-color: #27ae60;
    }
    .card.color-green h3 {
      color: #27ae60;
    }
    .card.color-purple {
      border-left-color: #9b59b6;
    }
    .card.color-purple h3 {
      color: #9b59b6;
    }
    .card.color-red {
      border-left-color: #e74c3c;
    }
    .card.color-red h3 {
      color: #e74c3c;
    }
    .card.color-yellow {
      border-left-color: #f39c12;
    }
    .card.color-yellow h3 {
      color: #f39c12;
    }
    .card.color-pink {
      border-left-color: #e91e63;
    }
    .card.color-pink h3 {
      color: #e91e63;
    }
    .card h3 { 
      margin: 0 0 12px 0; 
      color: #ff8c00;
      font-size: 18px;
    }
    .review-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }
    .review-avatar,
    .review-initials {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      flex-shrink: 0;
      border: 2px solid #444;
      background: #333;
    }
    .review-avatar {
      object-fit: cover;
    }
    .review-initials {
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: bold;
      font-size: 14px;
      text-transform: uppercase;
    }
    .review-name {
      margin: 0;
      font-size: 18px;
    }
    .review-info small {
      color: #999;
      font-size: 12px;
    }
    .card .servico-index {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #555;
      color: #fff;
      font-size: 12px;
      margin-right: 8px;
      flex-shrink: 0;
    }
    .card.color-green .servico-index { background: #27ae60; }
    .card.color-yellow .servico-index { background: #f39c12; }
    .card.color-red .servico-index { background: #e74c3c; }
    .card p { 
      margin: 8px 0; 
      color: #d0d0d0;
      line-height: 1.5;
    }
    .card small {
      color: #999;
      font-size: 13px;
    }
    .card button { 
      width: 100%; 
      margin-top: auto;
    }
    .servicos-section {
      margin-bottom: 8px;
    }
    .servicos-section-header {
      font-size: 20px;
      color: #ff8c00;
      margin: 6px 0 0 0;
      padding: 15px;
      border-left: 4px solid #ff8c00;
      background: rgba(255, 140, 0, 0.1);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
      transition: all 0.3s ease;
    }
    .servicos-section-header:hover {
      background: rgba(255, 140, 0, 0.2);
      transform: translateX(5px);
    }
    .servicos-section-header .arrow {
      font-size: 18px;
      transition: transform 0.3s ease;
    }
    .servicos-section-header.collapsed .arrow {
      transform: rotate(-90deg);
    }
    .servicos-section.sim .servicos-section-header {
      color: #27ae60;
      border-left-color: #27ae60;
      background: rgba(39, 174, 96, 0.1);
    }
    .servicos-section.sim .servicos-section-header:hover {
      background: rgba(39, 174, 96, 0.2);
    }
    .servicos-section.embreve .servicos-section-header {
      color: #f39c12;
      border-left-color: #f39c12;
      background: rgba(243, 156, 18, 0.1);
    }
    .servicos-section.embreve .servicos-section-header:hover {
      background: rgba(243, 156, 18, 0.2);
    }
    .servicos-section.nao .servicos-section-header {
      color: #e74c3c;
      border-left-color: #e74c3c;
      background: rgba(231, 76, 60, 0.1);
    }
    .servicos-section.nao .servicos-section-header:hover {
      background: rgba(231, 76, 60, 0.2);
    }
    .servicos-content {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
      max-height: 2000px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .servicos-content.collapsed {
      max-height: 0;
      margin-top: 0;
    }

    .avisos-section {
      margin-bottom: 8px;
    }
    .avisos-section-header {
      font-size: 20px;
      color: #ff8c00;
      margin: 6px 0 0 0;
      padding: 15px;
      border-left: 4px solid #ff8c00;
      background: rgba(255, 140, 0, 0.1);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
      transition: all 0.3s ease;
    }
    .avisos-section-header:hover {
      background: rgba(255, 140, 0, 0.2);
      transform: translateX(5px);
    }
    .avisos-section-header .arrow {
      font-size: 18px;
      transition: transform 0.3s ease;
    }
    .avisos-section-header.collapsed .arrow {
      transform: rotate(-90deg);
    }
    .avisos-section.danger .avisos-section-header {
      color: #e74c3c;
      border-left-color: #e74c3c;
      background: rgba(231, 76, 60, 0.1);
    }
    .avisos-section.danger .avisos-section-header:hover {
      background: rgba(231, 76, 60, 0.2);
    }
    .avisos-section.warning .avisos-section-header {
      color: #f39c12;
      border-left-color: #f39c12;
      background: rgba(243, 156, 18, 0.1);
    }
    .avisos-section.warning .avisos-section-header:hover {
      background: rgba(243, 156, 18, 0.2);
    }
    .avisos-section.success .avisos-section-header {
      color: #27ae60;
      border-left-color: #27ae60;
      background: rgba(39, 174, 96, 0.1);
    }
    .avisos-section.success .avisos-section-header:hover {
      background: rgba(39, 174, 96, 0.2);
    }
    .avisos-section.info .avisos-section-header {
      color: #3498db;
      border-left-color: #3498db;
      background: rgba(52, 152, 219, 0.1);
    }
    .avisos-section.info .avisos-section-header:hover {
      background: rgba(52, 152, 219, 0.2);
    }
    .avisos-content {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
      max-height: 2000px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .avisos-content.collapsed {
      max-height: 0;
      margin-top: 0;
    }

    /* RESPONSIVO */
    @media (max-width: 768px) {
      .container { 
        padding: 12px; 
      }
      h1 { 
        font-size: 24px; 
        margin-bottom: 20px;
      }
      h2 { 
        font-size: 19px;
        margin-bottom: 16px;
      }
      .tabs { 
        display: flex;
        gap: 10px;
        border-bottom: 1px solid #333;
        margin-bottom: 20px;
        overflow-x: auto;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 12px;
        flex-wrap: nowrap;
      }
      .tabs button {
        padding: 12px 16px; 
        font-size: 13px;
        border-radius: 8px;
        font-weight: 500;
        white-space: nowrap;
        flex-shrink: 0;
      }
      .tab-count {
        margin-left: 4px;
        font-size: 10px;
        min-width: 18px;
        height: 18px;
      }
      .btn-logout { 
        background: #e74c3c !important;
        margin-left: auto;
        flex-shrink: 0;
      }
      .tab-content {
        padding: 16px;
        border-radius: 12px;
      }
      form {
        padding: 16px; 
        gap: 14px;
        border-radius: 12px;
      }
      input, textarea {
        font-size: 16px;
        padding: 16px;
        border-radius: 10px;
      }
      button[type="submit"] {
        padding: 18px;
        font-size: 17px;
        font-weight: 600;
        border-radius: 10px;
        width: 100%;
      }
      select {
        width: 100%;
        padding: 16px;
        font-size: 16px;
        border-radius: 10px;
      }
      
      /* Tabelas viram cards no mobile */
      table, thead, tbody, th, td, tr { 
        display: block; 
      }
      thead tr { 
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tr { 
        margin-bottom: 15px;
        background: #2a2a2a;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 15px;
      }
      td { 
        border: none;
        position: relative;
        padding: 12px 12px 12px 50%;
        text-align: right;
      }
      td:before { 
        content: attr(data-label);
        position: absolute;
        left: 15px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        text-align: left;
        font-weight: bold;
        color: #ff8c00;
      }
      .cards {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      .card {
        padding: 15px;
      }
    }

    @media (max-width: 480px) {
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-size: 14px;
      }
      .container { 
        padding: 10px; 
      }
      h1 { 
        font-size: 18px;
        margin-bottom: 12px;
      }
      h2 { 
        font-size: 16px;
        margin-bottom: 12px;
      }
      .tabs { 
        display: flex;
        gap: 8px;
        border-bottom: 1px solid #333;
        margin-bottom: 15px;
        overflow-x: auto;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 10px;
        flex-wrap: nowrap;
      }
      .tabs button {
        padding: 10px 12px; 
        font-size: 12px;
        border-radius: 8px;
        font-weight: 500;
        white-space: nowrap;
        flex-shrink: 0;
      }
      .tab-count {
        margin-left: 3px;
        font-size: 9px;
        min-width: 16px;
        height: 16px;
        padding: 1px 5px;
      }
      .btn-logout { 
        background: #e74c3c !important;
        margin-left: auto;
        flex-shrink: 0;
        padding: 10px 12px !important;
        font-size: 12px !important;
        order: 999;
      }
      .tab-content {
        padding: 12px;
        border-radius: 10px;
        margin-bottom: 10px;
      }
      form {
        padding: 12px; 
        gap: 10px;
        border-radius: 10px;
        margin-bottom: 15px;
      }
      input, textarea {
        font-size: 16px;
        padding: 12px;
        border-radius: 8px;
      }
      button[type="submit"] {
        padding: 14px;
        font-size: 15px;
        font-weight: 600;
        border-radius: 8px;
        width: 100%;
      }
      select {
        width: 100%;
        padding: 12px;
        font-size: 14px;
        border-radius: 8px;
      }
      
      /* Tabelas */
      table, thead, tbody, th, td, tr { 
        display: block; 
      }
      thead tr { 
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tr { 
        margin-bottom: 12px;
        background: #2a2a2a;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 12px;
      }
      td { 
        border: none;
        position: relative;
        padding: 8px 8px 8px 45%;
        text-align: right;
        font-size: 13px;
      }
      td:before { 
        content: attr(data-label);
        position: absolute;
        left: 12px;
        width: 40%;
        padding-right: 8px;
        white-space: nowrap;
        text-align: left;
        font-weight: bold;
        color: #ff8c00;
        font-size: 12px;
      }
      .cards {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      .card {
        padding: 12px;
      }
      .card h3 { 
        font-size: 15px;
        margin-bottom: 8px;
      }
      .card p { 
        font-size: 13px;
      }
      .btn-delete {
        padding: 10px;
        font-size: 13px;
        width: 100%;
        margin-top: 10px;
      }
    }
        padding: 14px;
        border-radius: 8px;
        width: 100%;
      }
      select {
        width: 100%;
        padding: 14px;
        font-size: 16px;
        border-radius: 8px;
        background: #1a1a1a;
        color: #e0e0e0;
        border: 1px solid #444;
      }
      button[type="submit"] {
        padding: 16px;
        font-size: 16px;
        font-weight: 600;
        border-radius: 8px;
        width: 100%;
      }
      
      /* Tabelas viram cards no mobile */
      table, thead, tbody, th, td, tr { 
        display: block;
        width: 100%;
      }
      thead tr { 
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tr { 
        margin-bottom: 12px;
        background: #2a2a2a;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 12px;
      }
      td { 
        border: none;
        position: relative;
        padding: 10px 10px 10px 48%;
        text-align: right;
        font-size: 14px;
      }
      td:before { 
        content: attr(data-label);
        position: absolute;
        left: 12px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        text-align: left;
        font-weight: bold;
        color: #ff8c00;
        font-size: 13px;
      }
      .cards {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      .card {
        padding: 12px;
        border-radius: 8px;
      }
      .btn-delete {
        padding: 14px 12px;
        font-size: 15px;
        font-weight: 600;
        width: 100%;
        margin-top: 10px;
        border-radius: 8px;
      }
      .cards {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      .card {
        padding: 12px;
      }
      .card h3 {
        font-size: 16px;
      }
      .card p {
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Painel Admin - Isaac Barbearia</h1>
    
    <div class="tabs">
      <button class="active" onclick="showTab('servicos')">Servi√ßos <span id="count-servicos" class="tab-count">0</span></button>
      <button onclick="showTab('profissionais')">Profissionais <span id="count-profissionais" class="tab-count">0</span></button>
      <button onclick="showTab('parceiros')">Parceiros <span id="count-parceiros" class="tab-count">0</span></button>
      <button onclick="showTab('participacoes')">Participa√ß√£o <span id="count-participacoes" class="tab-count">0</span></button>
      <button onclick="showTab('localizacao')">Localiza√ß√£o</button>
      <button onclick="showTab('horarios')">Hor√°rios</button>
      <button onclick="showTab('agendamento')">Agendamento</button>
      <button onclick="showTab('avaliacoes')">Feedback <span id="count-avaliacoes" class="tab-count">0</span></button>
      <button onclick="showTab('avisos')">Avisos <span id="count-avisos" class="tab-count">0</span></button>
      <button class="btn-logout" onclick="logout()">Sair</button>
    </div>

    <!-- SERVI√áOS -->
    <div id="servicos" class="tab-content active">
      <h2>Gerenciar Servi√ßos & Pre√ßos</h2>
      <button onclick="limparDuplicatas()" style="margin-bottom: 15px; background: #e74c3c; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
        üóëÔ∏è Limpar Duplicatas do Firebase
      </button>
      
      <!-- Observa√ß√£o de Servi√ßos -->
      <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #ffd700;">
        <h3 style="color: #ffd700; margin-bottom: 15px;">üìå Observa√ß√£o de Servi√ßos & Pre√ßos</h3>
        <form onsubmit="saveObservacaoServicos(event)">
          <textarea id="obs-servicos" placeholder="Ex: Aumento de 10% nos cortes a partir de 01/03/2026" style="min-height: 100px;"></textarea>
          <button type="submit" style="background: #ffd700; color: #000; font-weight: bold;">Salvar Observa√ß√£o</button>
        </form>
        <div id="obs-servicos-display" style="margin-top: 15px; padding: 10px; background: #1a1a1a; border-radius: 4px; color: #ffd700; font-style: italic;"></div>
      </div>
      
      <form onsubmit="addServico(event)">
        <input type="text" id="serv-nome" placeholder="Nome do Servi√ßo" required>
        <select id="serv-realiza" required>
          <option value="">Realizamos este servi√ßo?</option>
          <option value="true">Sim</option>
          <option value="false">N√£o</option>
          <option value="soon">Em Breve</option>
        </select>
        <input type="number" id="serv-preco" placeholder="Pre√ßo (em R$)" step="0.01" min="0">
        <button type="submit">Adicionar Servi√ßo</button>
      </form>
      <div class="cards" id="serv-list"></div>
    </div>

    <!-- PROFISSIONAIS -->
    <div id="profissionais" class="tab-content">
      <h2>Gerenciar Profissionais</h2>
      <form onsubmit="addProfissional(event)">
        <input type="text" id="prof-nome" placeholder="Nome" required>
        <input type="text" id="prof-esp" placeholder="Especialidade" required>
        <input type="text" id="prof-tel" placeholder="Telefone">
        <input type="url" id="prof-img" placeholder="Link da Imagem (URL)">
        <button type="submit">Adicionar Profissional</button>
      </form>
      <div class="cards" id="prof-list"></div>
    </div>

    <!-- PARCEIROS -->
    <div id="parceiros" class="tab-content">
      <h2>Gerenciar Parcerias</h2>
      <form onsubmit="addParceiro(event)">
        <input type="text" id="parc-nome" placeholder="Nome da Parceria" required>
        <input type="url" id="parc-img" placeholder="Link do Logo (URL)" required>
        <button type="submit">Adicionar Parceria</button>
      </form>
      <div class="cards" id="parc-list"></div>
    </div>

    <!-- PARTICIPA√á√ÉO -->
    <div id="participacoes" class="tab-content">
      <h2>Participa√ß√£o Comunit√°ria</h2>
      <form onsubmit="addParticipacao(event)">
        <input type="text" id="part-titulo" placeholder="T√≠tulo do Evento" required>
        <textarea id="part-desc" placeholder="Descri√ß√£o"></textarea>
        <input type="date" id="part-data" required>
        <button type="submit">Adicionar Evento</button>
      </form>
      <div class="cards" id="part-list"></div>
    </div>

    <!-- LOCALIZA√á√ÉO -->
    <div id="localizacao" class="tab-content">
      <h2>Localiza√ß√£o</h2>
      <form onsubmit="saveLocalizacao(event)">
        <input type="text" id="loc-endereco" placeholder="Endere√ßo completo" required>
        <input type="text" id="loc-bairro" placeholder="Bairro" required>
        <input type="text" id="loc-cidade" placeholder="Cidade" required>
        <input type="text" id="loc-referencia" placeholder="Refer√™ncia (ex: Pr√≥ximo √† pra√ßa)" required>
        <input type="text" id="loc-maps-link" placeholder="Link do Google Maps (share.google/...)">
        <button type="submit">Salvar Localiza√ß√£o</button>
      </form>
      <div id="loc-display" style="margin-top: 20px; padding: 15px; background: #2a2a2a; border-radius: 8px; border: 1px solid #333;"></div>
    </div>

    <!-- HOR√ÅRIOS -->
    <div id="horarios" class="tab-content">
      <h2>Hor√°rios de Funcionamento</h2>
      <form onsubmit="saveHorarios(event)">
        <input type="text" id="hor-seg-sex" placeholder="Seg-Sex (ex: 08:00 √†s 18:30)" required>
        <input type="text" id="hor-sabado" placeholder="S√°bado (ex: 14:30 √†s 18:30)" required>
        <input type="text" id="hor-domingo" placeholder="Domingo (ex: Fechado)" required>
        <input type="text" id="hor-pausa" placeholder="Pausa (ex: 12:00 √†s 15:00 de segunda a sexta)" required>
        <textarea id="hor-observacao" placeholder="Observa√ß√£o adicional (opcional)"></textarea>
        <button type="submit">Salvar Hor√°rios</button>
      </form>
      <div id="hor-display" style="margin-top: 20px; padding: 15px; background: #2a2a2a; border-radius: 8px; border: 1px solid #333;"></div>
    </div>

    <!-- AGENDAMENTO -->
    <div id="agendamento" class="tab-content">
      <h2>Informa√ß√µes de Agendamento</h2>
      <form onsubmit="saveAgendamento(event)">
        <input type="text" id="agen-whatsapp" placeholder="N√∫mero WhatsApp (ex: 11 99999-9999)" required>
        <input type="tel" id="agen-telefone" placeholder="Telefone (ex: 11 3333-3333)" required>
        <textarea id="agen-info" placeholder="Informa√ß√µes adicionais sobre agendamento" required></textarea>
        <textarea id="agen-observacao" placeholder="Observa√ß√£o (ex: Agendamento confirmado por WhatsApp)"></textarea>
        <button type="submit">Salvar Agendamento</button>
      </form>
      <div id="agen-display" style="margin-top: 20px; padding: 15px; background: #2a2a2a; border-radius: 8px; border: 1px solid #333;"></div>
    </div>

    <!-- FEEDBACK -->
    <div id="avaliacoes" class="tab-content">
      <h2>Feedback dos Clientes</h2>
      <form onsubmit="return addAvaliacaoManual(event)">
        <input type="text" id="aval-nome" placeholder="Nome do cliente" required>
        <input type="email" id="aval-email" placeholder="Email (opcional)">
        <input type="url" id="aval-foto" placeholder="URL da foto (opcional)">
        <select id="aval-estrelas" required>
          <option value="">Nota (1 a 5)</option>
          <option value="5">5</option>
          <option value="4">4</option>
          <option value="3">3</option>
          <option value="2">2</option>
          <option value="1">1</option>
        </select>
        <textarea id="aval-comentario" placeholder="Coment√°rio do cliente" required></textarea>
        <button type="submit">Adicionar Feedback</button>
      </form>
      <div class="cards" id="aval-list"></div>
    </div>

    <!-- AVISOS -->
    <div id="avisos" class="tab-content">
      <h2>Gerenciar Avisos</h2>
      <form onsubmit="addAviso(event)">
        <input type="text" id="aviso-titulo" placeholder="T√≠tulo do Aviso" required>
        <textarea id="aviso-conteudo" placeholder="Conte√∫do do Aviso" required></textarea>
        <select id="aviso-tipo" required>
          <option value="">Tipo de Aviso</option>
          <option value="info">Informativo</option>
          <option value="warning">Aviso</option>
          <option value="danger">Importante</option>
          <option value="success">Sucesso</option>
        </select>
        <button type="submit">Adicionar Aviso</button>
      </form>
      <div class="cards" id="avisos-list"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDE2tWDNCDrY6O20EWrDt-NkvZmCm_MR10",
      authDomain: "isaacbarbearia-admin.firebaseapp.com",
      projectId: "isaacbarbearia-admin",
      storageBucket: "isaacbarbearia-admin.firebasestorage.app",
      messagingSenderId: "308982033120",
      appId: "1:308982033120:web:38b82c1a3ca9e933be7e85"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Fun√ß√£o para carregar observa√ß√£o de servi√ßos
    window.loadObservacaoServicos = async () => {
      try {
        console.log('Tentando carregar observa√ß√£o...');
        const docRef = doc(db, 'config', 'servicos');
        const docSnap = await getDoc(docRef);
        console.log('Doc snap exists?', docSnap.exists());
        if (docSnap.exists()) {
          console.log('Dados do doc:', docSnap.data());
          const observacao = docSnap.data().observacao;
          if (observacao) {
            console.log('Observa√ß√£o encontrada:', observacao);
            const textarea = document.getElementById('obs-servicos');
            const display = document.getElementById('obs-servicos-display');
            console.log('Textarea encontrado?', textarea);
            console.log('Display encontrado?', display);
            if (textarea) textarea.value = observacao;
            if (display) display.innerHTML = observacao;
          }
        }
      } catch (err) {
        console.log('Erro ao carregar observa√ß√£o:', err);
      }
    };

    // Verifica autentica√ß√£o
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = './login.html';
      } else {
        // Carregar dados AP√ìS autentica√ß√£o
        console.log('Usu√°rio autenticado, carregando dados...');
        loadProfissionais();
        loadParceiros();
        loadParticipacoes();
        loadAvaliacoes();
        console.log('Chamando loadObservacaoServicos...');
        loadObservacaoServicos();
      }
    });

    // Tabs
    window.showTab = (tabName) => {
      // Fechar todas as se√ß√µes de servi√ßos
      closeAllServicos();
      closeAllAvisos();
      
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
    };

    // Fechar todas as se√ß√µes de servi√ßos
    window.closeAllServicos = () => {
      document.querySelectorAll('.servicos-section-header').forEach(header => {
        const content = header.nextElementSibling;
        if (content && !content.classList.contains('collapsed')) {
          content.classList.add('collapsed');
          header.classList.add('collapsed');
        }
      });
    };

    // Fechar todas as se√ß√µes de avisos
    window.closeAllAvisos = () => {
      document.querySelectorAll('.avisos-section-header').forEach(header => {
        const content = header.nextElementSibling;
        if (content && !content.classList.contains('collapsed')) {
          content.classList.add('collapsed');
          header.classList.add('collapsed');
        }
      });
    };

    // Logout
    window.logout = async () => {
      await signOut(auth);
      window.location.href = './login.html';
    };

    // Servi√ßos
    window.addServico = async (e) => {
      e.preventDefault();
      const realizaValue = document.getElementById('serv-realiza').value;
      let realiza;
      if (realizaValue === 'true') realiza = true;
      else if (realizaValue === 'false') realiza = false;
      else if (realizaValue === 'soon') realiza = 'soon';
      
      const preco = document.getElementById('serv-preco').value;
      await addDoc(collection(db, 'servicos'), {
        nome: document.getElementById('serv-nome').value,
        realiza: realiza,
        preco: realiza === true && preco ? parseFloat(preco) : 0
      });
      e.target.reset();
      loadServicos();
    };

    let isLoadingServicos = false;
    async function loadServicos() {
      if (isLoadingServicos) return;
      isLoadingServicos = true;
      
      try {
        const list = document.getElementById('serv-list');
        const snapshot = await getDocs(collection(db, 'servicos'));
        
        console.log('üìä Total de documentos no Firebase:', snapshot.size);
        
        // Agrupa por nome para detectar e eliminar duplicatas
        const servicosPorNome = {};
        snapshot.forEach(doc => {
          const data = doc.data();
          if (!servicosPorNome[data.nome]) {
            servicosPorNome[data.nome] = [];
          }
          servicosPorNome[data.nome].push({ id: doc.id, data });
        });
        
        // Agrupa servi√ßos por status
        const servicosPorStatus = {
          sim: [],
          nao: [],
          embreve: []
        };
        
        for (const nome in servicosPorNome) {
          const servicos = servicosPorNome[nome];
          
          // Se h√° duplicatas, avisa no console
          if (servicos.length > 1) {
            console.warn(`‚ö†Ô∏è Duplicata: "${nome}" tem ${servicos.length} entradas. IDs:`, servicos.map(s => s.id));
          }
          
          // Usa apenas o primeiro
          const servico = servicos[0];
          const data = servico.data;
          
          if (data.realiza === true) {
            servicosPorStatus.sim.push({ servico, data });
          } else if (data.realiza === false) {
            servicosPorStatus.nao.push({ servico, data });
          } else {
            servicosPorStatus.embreve.push({ servico, data });
          }
        }
        
        const rows = [];
        
        // Renderiza Sim (Verde)
        if (servicosPorStatus.sim.length > 0) {
          const cardsText = servicosPorStatus.sim.map((item, index) => {
            const precoText = item.data.preco > 0 ? `R$ ${item.data.preco.toFixed(0)}` : '-';
            return `<div class="card color-green">
              <h3><span class="servico-index">${index + 1}</span>${item.data.nome}</h3>
              <p><strong>Realizamos:</strong> Sim</p>
              <p><strong>Pre√ßo:</strong> ${precoText}</p>
              <button class="btn-delete" onclick="deleteServico('${item.servico.id}')">Deletar</button>
            </div>`;
          }).join('');
          
          rows.push(`
            <div class="servicos-section sim">
              <div class="servicos-section-header collapsed" onclick="toggleServicos(this)">
                <span>‚úÖ Realizamos (${servicosPorStatus.sim.length})</span>
                <span class="arrow">‚ñº</span>
              </div>
              <div class="servicos-content collapsed">
                ${cardsText}
              </div>
            </div>
          `);
        }
        
        // Renderiza Em Breve (Amarelo)
        if (servicosPorStatus.embreve.length > 0) {
          const cardsText = servicosPorStatus.embreve.map((item, index) => {
            return `<div class="card color-yellow">
              <h3><span class="servico-index">${index + 1}</span>${item.data.nome}</h3>
              <p><strong>Realizamos:</strong> Em Breve</p>
              <p><strong>Pre√ßo:</strong> -</p>
              <button class="btn-delete" onclick="deleteServico('${item.servico.id}')">Deletar</button>
            </div>`;
          }).join('');
          
          rows.push(`
            <div class="servicos-section embreve">
              <div class="servicos-section-header collapsed" onclick="toggleServicos(this)">
                <span>‚è≥ Em Breve (${servicosPorStatus.embreve.length})</span>
                <span class="arrow">‚ñº</span>
              </div>
              <div class="servicos-content collapsed">
                ${cardsText}
              </div>
            </div>
          `);
        }
        
        // Renderiza N√£o (Vermelho)
        if (servicosPorStatus.nao.length > 0) {
          const cardsText = servicosPorStatus.nao.map((item, index) => {
            return `<div class="card color-red">
              <h3><span class="servico-index">${index + 1}</span>${item.data.nome}</h3>
              <p><strong>Realizamos:</strong> N√£o</p>
              <p><strong>Pre√ßo:</strong> -</p>
              <button class="btn-delete" onclick="deleteServico('${item.servico.id}')">Deletar</button>
            </div>`;
          }).join('');
          
          rows.push(`
            <div class="servicos-section nao">
              <div class="servicos-section-header collapsed" onclick="toggleServicos(this)">
                <span>‚ùå N√£o Realizamos (${servicosPorStatus.nao.length})</span>
                <span class="arrow">‚ñº</span>
              </div>
              <div class="servicos-content collapsed">
                ${cardsText}
              </div>
            </div>
          `);
        }
        
        list.innerHTML = rows.join('');
        // Garantir que tudo come√ßa fechado
        if (typeof closeAllServicos === 'function') {
          closeAllServicos();
        }
        // Atualizar o contador na aba - contar total de itens
        const totalServicos = servicosPorStatus.sim.length + servicosPorStatus.embreve.length + servicosPorStatus.nao.length;
        document.getElementById('count-servicos').textContent = totalServicos;
        console.log('‚úÖ Renderizados', totalServicos, 'servi√ßos √∫nicos de', snapshot.size, 'documentos');
      } finally {
        isLoadingServicos = false;
      }
    }

    window.limparDuplicatas = async () => {
      if (!confirm('Isso vai remover TODAS as duplicatas. Deseja continuar?')) return;
      
      try {
        const snapshot = await getDocs(collection(db, 'servicos'));
        const servicosPorNome = {};
        
        // Agrupa por nome
        snapshot.forEach(doc => {
          const data = doc.data();
          if (!servicosPorNome[data.nome]) {
            servicosPorNome[data.nome] = [];
          }
          servicosPorNome[data.nome].push({ id: doc.id, data });
        });
        
        // Deleta duplicatas (mant√©m apenas o primeiro)
        let deletados = 0;
        for (const nome in servicosPorNome) {
          const servicos = servicosPorNome[nome];
          if (servicos.length > 1) {
            // Deleta do segundo em diante
            for (let i = 1; i < servicos.length; i++) {
              await deleteDoc(doc(db, 'servicos', servicos[i].id));
              deletados++;
              console.log(`üóëÔ∏è Deletado duplicata de "${nome}" (ID: ${servicos[i].id})`);
            }
          }
        }
        
        alert(`‚úÖ ${deletados} duplicata(s) removida(s)!`);
        loadServicos();
      } catch (error) {
        console.error('Erro ao limpar duplicatas:', error);
        alert('‚ùå Erro ao limpar duplicatas. Veja o console.');
      }
    };

    window.deleteServico = async (id) => {
      await deleteDoc(doc(db, 'servicos', id));
      loadServicos();
    };

    // Observa√ß√£o de Servi√ßos
    window.saveObservacaoServicos = async (e) => {
      e.preventDefault();
      const texto = document.getElementById('obs-servicos').value;
      
      try {
        const docRef = doc(db, 'config', 'servicos');
        await setDoc(docRef, { observacao: texto }, { merge: true });
        loadObservacaoServicos();
      } catch (err) {
        alert('Erro ao salvar: ' + err.message);
      }
    };

    window.toggleServicos = (header) => {
      const content = header.nextElementSibling;
      const isCollapsed = content.classList.contains('collapsed');
      
      // Fechar todas as outras se√ß√µes
      document.querySelectorAll('.servicos-section-header').forEach(h => {
        if (h !== header) {
          const c = h.nextElementSibling;
          if (c && !c.classList.contains('collapsed')) {
            c.classList.add('collapsed');
            h.classList.add('collapsed');
          }
        }
      });
      
      // Toggle da se√ß√£o clicada
      if (isCollapsed) {
        content.classList.remove('collapsed');
        header.classList.remove('collapsed');
      } else {
        content.classList.add('collapsed');
        header.classList.add('collapsed');
      }
    };

    window.toggleAvisos = (header) => {
      const content = header.nextElementSibling;
      const isCollapsed = content.classList.contains('collapsed');

      // Fechar todas as outras se√ß√µes
      document.querySelectorAll('.avisos-section-header').forEach(h => {
        if (h !== header) {
          const c = h.nextElementSibling;
          if (c && !c.classList.contains('collapsed')) {
            c.classList.add('collapsed');
            h.classList.add('collapsed');
          }
        }
      });

      // Toggle da se√ß√£o clicada
      if (isCollapsed) {
        content.classList.remove('collapsed');
        header.classList.remove('collapsed');
      } else {
        content.classList.add('collapsed');
        header.classList.add('collapsed');
      }
    };

    // Profissionais
    window.addProfissional = async (e) => {
      e.preventDefault();
      await addDoc(collection(db, 'profissionais'), {
        nome: document.getElementById('prof-nome').value,
        especialidade: document.getElementById('prof-esp').value,
        telefone: document.getElementById('prof-tel').value,
        imagem: document.getElementById('prof-img').value
      });
      e.target.reset();
      loadProfissionais();
    };

    let isLoadingProfissionais = false;
    async function loadProfissionais() {
      if (isLoadingProfissionais) return;
      isLoadingProfissionais = true;
      
      try {
        const list = document.getElementById('prof-list');
        const snapshot = await getDocs(collection(db, 'profissionais'));
        const uniqueIds = new Set();
        const rows = [];
        let colorIndex = 0;
        const colors = ['color-blue', 'color-green', 'color-purple', 'color-pink', 'color-yellow', 'color-red'];
        
        snapshot.forEach(doc => {
          if (uniqueIds.has(doc.id)) return;
          uniqueIds.add(doc.id);
          
          const data = doc.data();
          const imgHtml = data.imagem ? `<img src="${data.imagem}" alt="${data.nome}" style="width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:10px;">` : '';
          const color = colors[colorIndex % colors.length];
          colorIndex++;
          
          rows.push(`<div class="card ${color}">
            ${imgHtml}
            <h3>${data.nome}</h3>
            <p><strong>Especialidade:</strong> ${data.especialidade}</p>
            <button class="btn-delete" onclick="deleteProfissional('${doc.id}')">Deletar</button>
          </div>`);
        });
        list.innerHTML = rows.join('');
        // Atualizar contador
        document.getElementById('count-profissionais').textContent = rows.length;
      } finally {
        isLoadingProfissionais = false;
      }
    }

    window.deleteProfissional = async (id) => {
      await deleteDoc(doc(db, 'profissionais', id));
      loadProfissionais();
    };

    // Parceiros
    window.addParceiro = async (e) => {
      e.preventDefault();
      await addDoc(collection(db, 'parceiros'), {
        nome: document.getElementById('parc-nome').value,
        imagem: document.getElementById('parc-img').value
      });
      e.target.reset();
      loadParceiros();
    };

    let isLoadingParceiros = false;
    async function loadParceiros() {
      if (isLoadingParceiros) return;
      isLoadingParceiros = true;
      
      try {
        const list = document.getElementById('parc-list');
        const snapshot = await getDocs(collection(db, 'parceiros'));
        const uniqueIds = new Set();
        const rows = [];
        let colorIndex = 0;
        const colors = ['color-blue', 'color-green', 'color-purple', 'color-pink', 'color-yellow', 'color-red'];
        
        snapshot.forEach(doc => {
          if (uniqueIds.has(doc.id)) return;
          uniqueIds.add(doc.id);
          
          const data = doc.data();
          const imgHtml = data.imagem ? `<img src="${data.imagem}" alt="${data.nome}" style="width:80px;height:auto;border-radius:8px;object-fit:cover;margin-bottom:10px;">` : '';
          const color = colors[colorIndex % colors.length];
          colorIndex++;
          
          rows.push(`<div class="card ${color}">
            ${imgHtml}
            <h3>${data.nome}</h3>
            <button class="btn-delete" onclick="deleteParceiro('${doc.id}')">Deletar</button>
          </div>`);
        });
        list.innerHTML = rows.join('');
        // Atualizar contador
        document.getElementById('count-parceiros').textContent = rows.length;
      } finally {
        isLoadingParceiros = false;
      }
    }

    window.deleteParceiro = async (id) => {
      await deleteDoc(doc(db, 'parceiros', id));
      loadParceiros();
    };

    // Participa√ß√µes
    window.addParticipacao = async (e) => {
      e.preventDefault();
      await addDoc(collection(db, 'participacoes'), {
        titulo: document.getElementById('part-titulo').value,
        descricao: document.getElementById('part-desc').value,
        data: document.getElementById('part-data').value
      });
      e.target.reset();
      loadParticipacoes();
    };

    let isLoadingParticipacoes = false;
    async function loadParticipacoes() {
      if (isLoadingParticipacoes) return;
      isLoadingParticipacoes = true;
      
      try {
        const list = document.getElementById('part-list');
        const snapshot = await getDocs(collection(db, 'participacoes'));
        const uniqueIds = new Set();
        const cards = [];
        let colorIndex = 0;
        const colors = ['color-blue', 'color-green', 'color-purple', 'color-pink', 'color-yellow'];
        
        snapshot.forEach(doc => {
          if (uniqueIds.has(doc.id)) return;
          uniqueIds.add(doc.id);
          
          const data = doc.data();
          const color = colors[colorIndex % colors.length];
          colorIndex++;
          
        cards.push(`<div class="card ${color}">
          <h3>${data.titulo}</h3>
          <p>${data.descricao || ''}</p>
          <p><strong>Data:</strong> ${data.data}</p>
          <button class="btn-delete" onclick="deleteParticipacao('${doc.id}')">Deletar</button>
        </div>`);
        });
        list.innerHTML = cards.join('');
        // Atualizar contador
        document.getElementById('count-participacoes').textContent = cards.length;
      } finally {
        isLoadingParticipacoes = false;
      }
    }

    window.deleteParticipacao = async (id) => {
      await deleteDoc(doc(db, 'participacoes', id));
      loadParticipacoes();
    };

    // Avalia√ß√µes - Com listener em tempo real
    let avaliacoesUnsubscribe = null;
    function getInitials(name, email) {
      const base = (name && name.trim()) ? name.trim() : (email || '');
      if (!base) return 'U';
      const parts = base.split(/\s+/).filter(Boolean);
      if (parts.length === 1) return parts[0].slice(0, 2);
      return `${parts[0][0] || ''}${parts[1][0] || ''}`.trim();
    }

    function normalizeReviewData(data) {
      const cliente = data.cliente ?? data.customer ?? data.nome ?? data.name ?? 'Sem nome';
      const comentario = data.comentario ?? data.comments ?? data.comment ?? 'Sem coment√°rio';
      const estrelas = data.estrelas ?? data.Stars ?? data.stars ?? data.rating ?? 0;
      const dataTextoBruto = data.data ?? data.date ?? data.Data ?? '';
      const email = data.email ?? data.Email ?? data.emailAddress ?? '';
      const foto = data.photoURL ?? data.photoUrl ?? data.foto ?? data.fotoUrl ?? data.avatar ?? data.image ?? data.imagem ?? data.profilePhoto ?? '';
      let dataTexto = dataTextoBruto;
      if (typeof dataTextoBruto === 'string' && dataTextoBruto.includes('T')) {
        const parsed = new Date(dataTextoBruto);
        if (!isNaN(parsed.getTime())) {
          dataTexto = parsed.toLocaleDateString('pt-BR');
        }
      }
      return { cliente, comentario, estrelas, dataTexto, email, foto };
    }

    window.addAvaliacaoManual = async (e) => {
      e.preventDefault();
      try {
        const data = {
          cliente: document.getElementById('aval-nome').value.trim(),
          email: document.getElementById('aval-email').value.trim() || '',
          photoURL: document.getElementById('aval-foto').value.trim() || '',
          estrelas: Number(document.getElementById('aval-estrelas').value),
          comentario: document.getElementById('aval-comentario').value.trim(),
          data: new Date().toISOString(),
          manual: true
        };
        await addDoc(collection(db, 'avaliacoes'), data);
        e.target.reset();
      } catch (error) {
        console.error('Erro ao adicionar feedback manual:', error);
        alert('Erro ao adicionar feedback. Verifique as permiss√µes.');
      }
      return false;
    };

    function renderAvaliacoes(list, docs) {
      if (!docs || docs.length === 0) {
        list.innerHTML = '<p style="text-align: center; color: #999;">Nenhuma avalia√ß√£o ainda</p>';
        document.getElementById('count-avaliacoes').textContent = 0;
        return;
      }

      const uniqueIds = new Set();
      const cards = [];
      let colorIndex = 0;
      const colors = ['color-blue', 'color-green', 'color-purple', 'color-pink', 'color-yellow'];

      docs.forEach(doc => {
        const key = doc?.ref?.parent?.id ? `${doc.ref.parent.id}:${doc.id}` : doc.id;
        if (uniqueIds.has(key)) return;
        uniqueIds.add(key);

        const data = doc.data();
        const collectionName = doc?.ref?.parent?.id || 'avaliacoes';
        const review = normalizeReviewData(data);
        const initials = getInitials(review.cliente, review.email);
        const avatarHtml = review.foto
          ? `<img class="review-avatar" src="${review.foto}" alt="${review.cliente}">`
          : `<div class="review-initials">${initials}</div>`;
        const color = colors[colorIndex % colors.length];
        colorIndex++;

        console.log('Renderizando avalia√ß√£o:', data);
        cards.push(`<div class="card ${color}">
          <div class="review-header">
            ${avatarHtml}
            <div class="review-info">
              <h3 class="review-name">${review.cliente}</h3>
              ${review.email ? `<small>${review.email}</small>` : ''}
            </div>
          </div>
          <p><strong>Estrelas:</strong> ${review.estrelas}/5</p>
          <p>${review.comentario}</p>
          <p><small>${review.dataTexto || 'Sem data'}</small></p>
          <button class="btn-delete" onclick="deleteAvaliacao('${doc.id}','${collectionName}')">Deletar</button>
        </div>`);
      });

      list.innerHTML = cards.join('');
      document.getElementById('count-avaliacoes').textContent = cards.length;
    }

    async function loadAvaliacoesFallback(list) {
      try {
        const [feedbackSnap, feedbacksSnap, reviewsSnap, ReviewsSnap] = await Promise.all([
          getDocs(collection(db, 'feedback')),
          getDocs(collection(db, 'feedbacks')),
          getDocs(collection(db, 'reviews')),
          getDocs(collection(db, 'Reviews'))
        ]);

        const fallbackDocs = [
          ...feedbackSnap.docs,
          ...feedbacksSnap.docs,
          ...reviewsSnap.docs,
          ...ReviewsSnap.docs
        ];
        renderAvaliacoes(list, fallbackDocs);
      } catch (error) {
        console.error('Erro ao carregar avalia√ß√µes (fallback):', error);
        list.innerHTML = '<p style="color: red;">Erro ao carregar avalia√ß√µes</p>';
      }
    }

    function loadAvaliacoes() {
      const list = document.getElementById('aval-list');
      console.log('Iniciando loadAvaliacoes...');

      // Remove o listener anterior se existir
      if (avaliacoesUnsubscribe) {
        avaliacoesUnsubscribe();
      }

      try {
        avaliacoesUnsubscribe = onSnapshot(collection(db, 'avaliacoes'), async (snapshot) => {
          console.log('Snapshot recebido:', snapshot.docs.length, 'documentos');

          if (snapshot.empty) {
            await loadAvaliacoesFallback(list);
            return;
          }

          renderAvaliacoes(list, snapshot.docs);
        }, (error) => {
          console.error('Erro ao carregar avalia√ß√µes:', error);
          list.innerHTML = '<p style="color: red;">Erro ao carregar avalia√ß√µes</p>';
        });
      } catch (error) {
        console.error('Erro em loadAvaliacoes:', error);
      }
    }

    window.deleteAvaliacao = async (id, collectionName = 'avaliacoes') => {
      try {
        await deleteDoc(doc(db, collectionName, id));
        console.log('Avalia√ß√£o deletada:', id, 'em', collectionName);
      } catch (error) {
        console.error('Erro ao deletar avalia√ß√£o:', error);
      }
    };

    // Localiza√ß√£o
    window.saveLocalizacao = async (e) => {
      e.preventDefault();
      const data = {
        endereco: document.getElementById('loc-endereco').value,
        bairro: document.getElementById('loc-bairro').value,
        cidade: document.getElementById('loc-cidade').value,
        referencia: document.getElementById('loc-referencia').value,
        googleMapsLink: document.getElementById('loc-maps-link').value
      };
      await setDoc(doc(db, 'config', 'localizacao'), data);
      displayLocalizacao(data);
      e.target.reset();
    };

    async function displayLocalizacao(data) {
      const display = document.getElementById('loc-display');
      display.innerHTML = `
        <p><strong>üìç ${data.endereco}</strong></p>
        <p>${data.bairro}, ${data.cidade}</p>
        <p><em>${data.referencia}</em></p>
        <p><strong>üó∫Ô∏è Google Maps:</strong> <a href="${data.googleMapsLink}" target="_blank" style="color: #ff8c00; text-decoration: underline;">${data.googleMapsLink || 'N√£o configurado'}</a></p>
      `;
    }

    async function loadLocalizacao() {
      try {
        const docSnap = await getDoc(doc(db, 'config', 'localizacao'));
        if (docSnap.exists()) {
          const data = docSnap.data();
          console.log('Dados carregados:', data);
          document.getElementById('loc-endereco').value = data.endereco || '';
          document.getElementById('loc-bairro').value = data.bairro || '';
          document.getElementById('loc-cidade').value = data.cidade || '';
          document.getElementById('loc-referencia').value = data.referencia || '';
          document.getElementById('loc-maps-link').value = data.googleMapsLink || '';
          console.log('Link carregado:', data.googleMapsLink);
          displayLocalizacao(data);
        }
      } catch (error) {
        console.error('Erro ao carregar localiza√ß√£o:', error);
      }
    }

    // Hor√°rios
    window.saveHorarios = async (e) => {
      e.preventDefault();
      const data = {
        segSex: document.getElementById('hor-seg-sex').value,
        sabado: document.getElementById('hor-sabado').value,
        domingo: document.getElementById('hor-domingo').value,
        pausa: document.getElementById('hor-pausa').value,
        observacao: document.getElementById('hor-observacao').value || ''
      };
      await setDoc(doc(db, 'config', 'horarios'), data);
      displayHorarios(data);
      e.target.reset();
    };

    async function displayHorarios(data) {
      const display = document.getElementById('hor-display');
      let html = `
        <p><strong>‚è∞ Hor√°rios de Funcionamento</strong></p>
        <p>Segunda a Sexta: ${data.segSex}</p>
        <p>S√°bado: ${data.sabado}</p>
        <p>Domingo: ${data.domingo}</p>
      `;
      
      if (data.pausa) {
        html += `<p style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #444; color: #ffd700; font-weight: bold;"><svg style="width: 14px; height: 14px; display: inline; margin-right: 6px; vertical-align: middle; fill: #ffd700;" viewBox="0 0 24 24"><rect x="6" y="4" width="3" height="16" rx="1"/><rect x="15" y="4" width="3" height="16" rx="1"/></svg>Pausa: ${data.pausa}</p>`;
      }
      
      if (data.observacao) {
        html += `<p style="margin-top: 10px; font-size: 12px; color: #e74c3c; font-style: italic;"><svg style="width: 14px; height: 14px; display: inline; margin-right: 6px; vertical-align: middle; stroke: #e74c3c; fill: none; stroke-width: 1.5;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 8v4M12 16h.01" stroke-linecap="round"/></svg>${data.observacao}</p>`;
      }
      
      display.innerHTML = html;
    }

    async function loadHorarios() {
      try {
        const docSnap = await getDoc(doc(db, 'config', 'horarios'));
        if (docSnap.exists()) {
          const data = docSnap.data();
          document.getElementById('hor-seg-sex').value = data.segSex || '';
          document.getElementById('hor-sabado').value = data.sabado || '';
          document.getElementById('hor-domingo').value = data.domingo || '';
          document.getElementById('hor-pausa').value = data.pausa || '';
          document.getElementById('hor-observacao').value = data.observacao || '';
          displayHorarios(data);
        }
      } catch (error) {
        console.error('Erro ao carregar hor√°rios:', error);
      }
    }

    // Agendamento
    window.saveAgendamento = async (e) => {
      e.preventDefault();
      const data = {
        whatsapp: document.getElementById('agen-whatsapp').value,
        telefone: document.getElementById('agen-telefone').value,
        info: document.getElementById('agen-info').value,
        observacao: document.getElementById('agen-observacao').value
      };
      await setDoc(doc(db, 'config', 'agendamento'), data);
      displayAgendamento(data);
      e.target.reset();
    };

    async function displayAgendamento(data) {
      const display = document.getElementById('agen-display');
      const whatsappLink = `https://wa.me/${data.whatsapp.replace(/\D/g, '')}`;
      const telefoneLink = `tel:${data.telefone.replace(/\D/g, '')}`;
      let observacaoHtml = '';
      if (data.observacao) {
        observacaoHtml = `<p style="margin-top: 10px; padding: 8px; background: #1a1a1a; border-left: 3px solid #ffd700; border-radius: 4px;"><strong style="display: flex; align-items: center; gap: 6px;"><svg style="width: 18px; height: 18px; fill: #ffd700;" viewBox="0 0 24 24"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>Observa√ß√£o:</strong> ${data.observacao}</p>`;
      }
      display.innerHTML = `
        <p><strong>üìû Agendamento</strong></p>
        <p>WhatsApp: <a href="${whatsappLink}" target="_blank" style="color: #ff8c00; text-decoration: none;">${data.whatsapp} üí¨</a></p>
        <p>Telefone: <a href="${telefoneLink}" style="color: #ff8c00; text-decoration: none;">${data.telefone} ‚òéÔ∏è</a></p>
        <p>${data.info}</p>
        ${observacaoHtml}
      `;
    }

    async function loadAgendamento() {
      try {
        const docSnap = await getDoc(doc(db, 'config', 'agendamento'));
        if (docSnap.exists()) {
          const data = docSnap.data();
          document.getElementById('agen-whatsapp').value = data.whatsapp || '';
          document.getElementById('agen-telefone').value = data.telefone || '';
          document.getElementById('agen-info').value = data.info || '';
          document.getElementById('agen-observacao').value = data.observacao || '';
          displayAgendamento(data);
        }
      } catch (error) {
        console.error('Erro ao carregar agendamento:', error);
      }
    }

    // Carregar tudo ao iniciar
    loadServicos();
    loadProfissionais();
    loadParceiros();
    loadParticipacoes();
    loadLocalizacao();
    loadHorarios();
    loadAgendamento();
    loadAvaliacoes();
    loadAvisos();

    // AVISOS
    window.addAviso = async (e) => {
      e.preventDefault();
      await addDoc(collection(db, 'avisos'), {
        titulo: document.getElementById('aviso-titulo').value,
        conteudo: document.getElementById('aviso-conteudo').value,
        tipo: document.getElementById('aviso-tipo').value,
        data: new Date().toISOString()
      });
      e.target.reset();
      loadAvisos();
    };

    async function loadAvisos() {
      try {
        const snapshot = await getDocs(collection(db, 'avisos'));
        const list = document.getElementById('avisos-list');

        const avisosPorTipo = { danger: [], warning: [], success: [], info: [] };
        snapshot.forEach(doc => {
          const data = doc.data();
          const tipo = ['danger', 'warning', 'success', 'info'].includes(data.tipo) ? data.tipo : 'info';
          avisosPorTipo[tipo].push({ id: doc.id, ...data });
        });

        const sections = [
          { key: 'danger', label: 'üö® Urgente', color: '#e74c3c' },
          { key: 'warning', label: '‚ö†Ô∏è Aten√ß√£o', color: '#f39c12' },
          { key: 'success', label: '‚úÖ Sucesso', color: '#27ae60' },
          { key: 'info', label: '‚ÑπÔ∏è Informa√ß√µes', color: '#3498db' }
        ];

        const rows = [];

        sections.forEach(({ key, label, color }) => {
          const itens = avisosPorTipo[key];
          if (!itens.length) return;

          itens.sort((a, b) => new Date(b.data) - new Date(a.data));

          const cardsText = itens.map(aviso => {
            const dataTexto = aviso.data ? new Date(aviso.data).toLocaleString('pt-BR') : '';
            return `<div class="card" style="border-left: 4px solid ${color};">
              <h3 style="color: ${color};">${aviso.titulo}</h3>
              <p>${aviso.conteudo}</p>
              <small>${dataTexto}</small>
              <button class="btn-delete" onclick="deleteAviso('${aviso.id}')">Deletar</button>
            </div>`;
          }).join('');

          rows.push(`
            <div class="avisos-section ${key}">
              <div class="avisos-section-header collapsed" onclick="toggleAvisos(this)">
                <span>${label} (${itens.length})</span>
                <span class="arrow">‚ñº</span>
              </div>
              <div class="avisos-content collapsed">
                ${cardsText}
              </div>
            </div>
          `);
        });

        if (rows.length === 0) {
          list.innerHTML = '<p style="text-align: center; color: #999;">Nenhum aviso cadastrado</p>';
        } else {
          list.innerHTML = rows.join('');
        }

        // Atualizar o contador na aba
        document.getElementById('count-avisos').textContent = snapshot.size;
        if (typeof closeAllAvisos === 'function') {
          closeAllAvisos();
        }
      } catch (error) {
        console.error('Erro ao carregar avisos:', error);
      }
    }

    window.deleteAviso = async (id) => {
      if (confirm('Deseja deletar este aviso?')) {
        await deleteDoc(doc(db, 'avisos', id));
        loadAvisos();
      }
    };
  </script>
</body>
</html>
