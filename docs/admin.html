<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Admin - Isaac Barbearia</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: Arial, sans-serif; 
      background: #1a1a1a; 
      color: #e0e0e0;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    h1 { 
      color: #ff8c00; 
      text-align: center; 
      margin-bottom: 30px; 
      text-shadow: 0 0 10px rgba(255, 140, 0, 0.3);
    }
    h2 { 
      color: #ff8c00; 
      margin-bottom: 20px; 
    }
    .tabs { 
      display: flex; 
      gap: 10px; 
      margin-bottom: 30px; 
      border-bottom: 2px solid #333; 
    }
    .tabs button {
      padding: 12px 20px; 
      background: #2a2a2a; 
      color: #b0b0b0;
      border: none;
      cursor: pointer; 
      font-size: 16px; 
      border-radius: 4px 4px 0 0;
      transition: all 0.3s;
    }
    .tabs button.active { 
      background: #ff8c00; 
      color: #000; 
    }
    .tabs button:hover { 
      background: #ff8c00; 
      color: #000; 
    }
    .btn-logout { 
      margin-left: auto; 
      background: #e74c3c !important;
    }
    .btn-logout:hover {
      background: #c0392b !important;
    }
    .tab-content { 
      display: none; 
      animation: fadeIn 0.3s; 
      background: #242424; 
      padding: 20px; 
      border-radius: 8px;
      border: 1px solid #333;
    }
    .tab-content.active { 
      display: block; 
    }
    @keyframes fadeIn { 
      from { opacity: 0; } 
      to { opacity: 1; } 
    }
    form {
      background: #2a2a2a; 
      padding: 20px; 
      border-radius: 8px;
      margin-bottom: 30px; 
      display: flex; 
      flex-direction: column; 
      gap: 10px;
      border: 1px solid #333;
    }
    input, textarea {
      padding: 10px; 
      border: 1px solid #444; 
      border-radius: 4px;
      font-size: 14px; 
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: #e0e0e0;
    }
    input:focus, textarea:focus {
      outline: none;
      border-color: #ff8c00;
      box-shadow: 0 0 5px rgba(255, 140, 0, 0.3);
    }
    textarea { 
      resize: vertical; 
      min-height: 80px; 
    }
    button[type="submit"] {
      padding: 12px 20px; 
      background: #ff8c00; 
      color: #000;
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s;
    }
    button[type="submit"]:hover { 
      background: #ffaa00;
      box-shadow: 0 0 10px rgba(255, 140, 0, 0.5);
    }
    table {
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 20px;
      background: #2a2a2a; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      border: 1px solid #333;
    }
    thead { 
      background: #ff8c00; 
      color: #000;
    }
    th, td { 
      padding: 12px; 
      text-align: left; 
      border-bottom: 1px solid #333;
    }
    tbody tr:hover { 
      background: #333;
    }
    .btn-delete {
      padding: 6px 12px; 
      background: #e74c3c; 
      color: white;
      border: none; 
      border-radius: 4px; 
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-delete:hover { 
      background: #c0392b;
      box-shadow: 0 0 8px rgba(231, 76, 60, 0.5);
    }
    .cards {
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px; 
      margin-top: 20px;
    }
    .card {
      background: #2a2a2a; 
      padding: 20px; 
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      border: 1px solid #444;
    }
    .card h3 { 
      margin: 0 0 12px 0; 
      color: #ff8c00;
      font-size: 18px;
    }
    .card p { 
      margin: 8px 0; 
      color: #d0d0d0;
      line-height: 1.5;
    }
    .card small {
      color: #999;
      font-size: 13px;
    }
    .card button { 
      width: 100%; 
      margin-top: 15px; 
    }

    /* RESPONSIVO */
    @media (max-width: 768px) {
      .container { 
        padding: 10px; 
      }
      h1 { 
        font-size: 22px; 
        margin-bottom: 15px;
      }
      h2 { 
        font-size: 18px;
        margin-bottom: 15px;
      }
      .tabs { 
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        border-bottom: none;
      }
      .tabs button {
        padding: 12px 10px; 
        font-size: 13px;
        border-radius: 6px;
      }
      .btn-logout { 
        grid-column: 1 / -1;
        margin-top: 0;
      }
      .tab-content {
        padding: 15px;
      }
      form {
        padding: 15px; 
        gap: 12px;
      }
      input, textarea {
        font-size: 16px;
        padding: 14px;
      }
      button[type="submit"] {
        padding: 14px 16px; 
        font-size: 15px;
      }
      
      /* Tabelas viram cards no mobile */
      table, thead, tbody, th, td, tr { 
        display: block; 
      }
      thead tr { 
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tr { 
        margin-bottom: 15px;
        background: #2a2a2a;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 15px;
      }
      td { 
        border: none;
        position: relative;
        padding: 12px 12px 12px 50%;
        text-align: right;
      }
      td:before { 
        content: attr(data-label);
        position: absolute;
        left: 15px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        text-align: left;
        font-weight: bold;
        color: #ff8c00;
      }
      .cards {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      .card {
        padding: 15px;
      }
    }

    @media (max-width: 480px) {
      .container { 
        padding: 8px; 
      }
      h1 { 
        font-size: 20px;
        margin-bottom: 12px;
      }
      h2 { 
        font-size: 16px;
        margin-bottom: 12px;
      }
      .tabs { 
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .tabs button {
        padding: 16px; 
        font-size: 15px;
        border-radius: 8px;
        font-weight: 600;
      }
      .btn-logout { 
        order: 999;
        padding: 16px !important;
        font-size: 15px !important;
        margin-top: 10px;
      }
      .tab-content {
        padding: 15px;
        border-radius: 10px;
      }
      form {
        padding: 15px; 
        gap: 12px;
        border-radius: 10px;
      }
      input, textarea {
        font-size: 16px;
        padding: 14px;
        border-radius: 8px;
      }
      button[type="submit"] {
        padding: 16px;
        font-size: 16px;
        font-weight: 600;
        border-radius: 8px;
      }
      td { 
        padding: 12px 12px 12px 50%;
        font-size: 14px;
      }
      td:before {
        font-size: 13px;
        font-weight: 600;
      }
      .btn-delete {
        padding: 12px 16px;
        font-size: 15px;
        font-weight: 600;
        width: 100%;
        margin-top: 8px;
        border-radius: 8px;
      }
        font-weight: bold;
        color: #ff8c00;
        display: inline-block;
        width: 100px;
        margin-right: 10px;
      }
      .btn-delete {
        width: 100%;
        padding: 10px;
      }
      .cards {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      .card {
        padding: 12px;
      }
      .card h3 {
        font-size: 16px;
      }
      .card p {
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Painel Admin - Isaac Barbearia</h1>
    
    <div class="tabs">
      <button class="active" onclick="showTab('profissionais')">Profissionais</button>
      <button onclick="showTab('parceiros')">Parceiros</button>
      <button onclick="showTab('participacoes')">Participação</button>
      <button onclick="showTab('avaliacoes')">Avaliações</button>
      <button class="btn-logout" onclick="logout()">Sair</button>
    </div>

    <!-- PROFISSIONAIS -->
    <div id="profissionais" class="tab-content active">
      <h2>Gerenciar Profissionais</h2>
      <form onsubmit="addProfissional(event)">
        <input type="text" id="prof-nome" placeholder="Nome" required>
        <input type="text" id="prof-esp" placeholder="Especialidade" required>
        <input type="text" id="prof-tel" placeholder="Telefone">
        <input type="url" id="prof-img" placeholder="Link da Imagem (URL)">
        <button type="submit">Adicionar Profissional</button>
      </form>
      <table>
        <thead><tr><th>Nome</th><th>Especialidade</th><th>Imagem</th><th>Ações</th></tr></thead>
        <tbody id="prof-list"></tbody>
      </table>
    </div>

    <!-- PARCEIROS -->
    <div id="parceiros" class="tab-content">
      <h2>Gerenciar Parceiros e Convênios</h2>
      <form onsubmit="addParceiro(event)">
        <input type="text" id="parc-nome" placeholder="Nome do Parceiro" required>
        <input type="text" id="parc-desc" placeholder="Descrição">
        <input type="text" id="parc-desc-percent" placeholder="Desconto (%)">
        <input type="url" id="parc-img" placeholder="Link da Imagem (URL)">
        <button type="submit">Adicionar Parceiro</button>
      </form>
      <table>
        <thead><tr><th>Nome</th><th>Descrição</th><th>Desconto</th><th>Imagem</th><th>Ações</th></tr></thead>
        <tbody id="parc-list"></tbody>
      </table>
    </div>

    <!-- PARTICIPAÇÃO -->
    <div id="participacoes" class="tab-content">
      <h2>Participação Comunitária</h2>
      <form onsubmit="addParticipacao(event)">
        <input type="text" id="part-titulo" placeholder="Título do Evento" required>
        <textarea id="part-desc" placeholder="Descrição"></textarea>
        <input type="date" id="part-data" required>
        <button type="submit">Adicionar Evento</button>
      </form>
      <div class="cards" id="part-list"></div>
    </div>

    <!-- AVALIAÇÕES -->
    <div id="avaliacoes" class="tab-content">
      <h2>Avaliações dos Clientes</h2>
      <div class="cards" id="aval-list"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDE2tWDNCDrY6O20EWrDt-NkvZmCm_MR10",
      authDomain: "isaacbarbearia-admin.firebaseapp.com",
      projectId: "isaacbarbearia-admin",
      storageBucket: "isaacbarbearia-admin.firebasestorage.app",
      messagingSenderId: "308982033120",
      appId: "1:308982033120:web:38b82c1a3ca9e933be7e85"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Verifica autenticação
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = '/isaacbarbearia/login.html';
      } else {
        // Carregar dados APÓS autenticação
        console.log('Usuário autenticado, carregando dados...');
        loadProfissionais();
        loadParceiros();
        loadParticipacoes();
        loadAvaliacoes();
      }
    });

    // Tabs
    window.showTab = (tabName) => {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
    };

    // Logout
    window.logout = async () => {
      await signOut(auth);
      window.location.href = '/isaacbarbearia/login.html';
    };

    // Profissionais
    window.addProfissional = async (e) => {
      e.preventDefault();
      await addDoc(collection(db, 'profissionais'), {
        nome: document.getElementById('prof-nome').value,
        especialidade: document.getElementById('prof-esp').value,
        telefone: document.getElementById('prof-tel').value,
        imagem: document.getElementById('prof-img').value
      });
      e.target.reset();
      loadProfissionais();
    };

    async function loadProfissionais() {
      const list = document.getElementById('prof-list');
      list.innerHTML = '';
      const snapshot = await getDocs(collection(db, 'profissionais'));
      snapshot.forEach(doc => {
        const data = doc.data();
        const imgHtml = data.imagem ? `<img src="${data.imagem}" alt="${data.nome}" style="width:50px;height:50px;border-radius:50%;object-fit:cover;">` : '-';
        list.innerHTML += `<tr>
          <td data-label="Nome">${data.nome}</td>
          <td data-label="Especialidade">${data.especialidade}</td>
          <td data-label="Imagem">${imgHtml}</td>
          <td data-label="Ações"><button class="btn-delete" onclick="deleteProfissional('${doc.id}')">Deletar</button></td>
        </tr>`;
      });
    }

    window.deleteProfissional = async (id) => {
      await deleteDoc(doc(db, 'profissionais', id));
      loadProfissionais();
    };

    // Parceiros
    window.addParceiro = async (e) => {
      e.preventDefault();
      await addDoc(collection(db, 'parceiros'), {
        nome: document.getElementById('parc-nome').value,
        descricao: document.getElementById('parc-desc').value,
        desconto: document.getElementById('parc-desc-percent').value,
        imagem: document.getElementById('parc-img').value
      });
      e.target.reset();
      loadParceiros();
    };

    async function loadParceiros() {
      const list = document.getElementById('parc-list');
      list.innerHTML = '';
      const snapshot = await getDocs(collection(db, 'parceiros'));
      snapshot.forEach(doc => {
        const data = doc.data();
        const imgHtml = data.imagem ? `<img src="${data.imagem}" alt="${data.nome}" style="width:50px;height:50px;border-radius:50%;object-fit:cover;">` : '-';
        list.innerHTML += `<tr>
          <td data-label="Nome">${data.nome}</td>
          <td data-label="Descrição">${data.descricao || '-'}</td>
          <td data-label="Desconto">${data.desconto}%</td>
          <td data-label="Imagem">${imgHtml}</td>
          <td data-label="Ações"><button class="btn-delete" onclick="deleteParceiro('${doc.id}')">Deletar</button></td>
        </tr>`;
      });
    }

    window.deleteParceiro = async (id) => {
      await deleteDoc(doc(db, 'parceiros', id));
      loadParceiros();
    };

    // Participações
    window.addParticipacao = async (e) => {
      e.preventDefault();
      await addDoc(collection(db, 'participacoes'), {
        titulo: document.getElementById('part-titulo').value,
        descricao: document.getElementById('part-desc').value,
        data: document.getElementById('part-data').value
      });
      e.target.reset();
      loadParticipacoes();
    };

    async function loadParticipacoes() {
      const list = document.getElementById('part-list');
      list.innerHTML = '';
      const snapshot = await getDocs(collection(db, 'participacoes'));
      snapshot.forEach(doc => {
        const data = doc.data();
        list.innerHTML += `<div class="card">
          <h3>${data.titulo}</h3>
          <p>${data.descricao || ''}</p>
          <p><strong>Data:</strong> ${data.data}</p>
          <button class="btn-delete" onclick="deleteParticipacao('${doc.id}')">Deletar</button>
        </div>`;
      });
    }

    window.deleteParticipacao = async (id) => {
      await deleteDoc(doc(db, 'participacoes', id));
      loadParticipacoes();
    };

    // Avaliações - Com listener em tempo real
    function loadAvaliacoes() {
      const list = document.getElementById('aval-list');
      console.log('Iniciando loadAvaliacoes...');
      
      try {
        onSnapshot(collection(db, 'avaliacoes'), (snapshot) => {
          console.log('Snapshot recebido:', snapshot.docs.length, 'documentos');
          list.innerHTML = '';
          
          if (snapshot.empty) {
            list.innerHTML = '<p style="text-align: center; color: #999;">Nenhuma avaliação ainda</p>';
            return;
          }
          
          snapshot.forEach(doc => {
            const data = doc.data();
            console.log('Renderizando avaliação:', data);
            list.innerHTML += `<div class="card">
              <h3>${data.cliente || 'Sem nome'}</h3>
              <p><strong>Estrelas:</strong> ${data.estrelas || 0}/5</p>
              <p>${data.comentario || 'Sem comentário'}</p>
              <p><small>${data.data || 'Sem data'}</small></p>
              <button class="btn-delete" onclick="deleteAvaliacao('${doc.id}')">Deletar</button>
            </div>`;
          });
        }, (error) => {
          console.error('Erro ao carregar avaliações:', error);
          list.innerHTML = '<p style="color: red;">Erro ao carregar avaliações</p>';
        });
      } catch (error) {
        console.error('Erro em loadAvaliacoes:', error);
      }
    }

    window.deleteAvaliacao = async (id) => {
      try {
        await deleteDoc(doc(db, 'avaliacoes', id));
        console.log('Avaliação deletada:', id);
      } catch (error) {
        console.error('Erro ao deletar avaliação:', error);
      }
    };

    // Carregar tudo
    document.getElementById('prof-form').addEventListener('submit', addProfissional);
    document.getElementById('parc-form').addEventListener('submit', addParceiro);
    document.getElementById('part-form').addEventListener('submit', addParticipacao);
  </script>
</body>
</html>

<!-- Cache bust: 2026-01-28-23-55-12 -->
